<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Scanner Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .btn { 
            background: #667eea; 
            color: white; 
            border: none; 
            padding: 15px 30px; 
            border-radius: 10px; 
            margin: 10px; 
            cursor: pointer; 
        }
        .form-group { margin: 15px 0; }
        .form-group label { display: block; margin-bottom: 5px; }
        .form-group input { padding: 10px; width: 300px; border: 1px solid #ccc; border-radius: 5px; }
        #status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .book-item { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Book Scanner - Test Version</h1>
    
    <div class="form-group">
        <label for="scannerName">Your Name:</label>
        <input type="text" id="scannerName" placeholder="Enter your name" />
    </div>
    
    <div class="form-group">
        <label for="defaultTeacher">Teacher:</label>
        <input type="text" id="defaultTeacher" placeholder="Enter teacher name" />
    </div>
    
    <button class="btn" onclick="saveInfo()">Save My Info</button>
    <button class="btn" onclick="clearInfo()">Clear Info</button>
    <button class="btn" onclick="takePhoto()">Take Photo</button>
    
    <div id="status"></div>
    
    <h2>Test Photo Upload</h2>
    <input type="file" id="photoUpload" accept="image/*" capture="environment" onchange="handleFile(this)">
    
    <div id="extractedData" style="display: none;">
        <h3>Book Information</h3>
        <div class="form-group">
            <label for="bookTitle">Title:</label>
            <input type="text" id="bookTitle" placeholder="Book title" />
        </div>
        <div class="form-group">
            <label for="bookAuthor">Author:</label>
            <input type="text" id="bookAuthor" placeholder="Author name" />
        </div>
        <div class="form-group">
            <label for="bookPublisher">Publisher:</label>
            <input type="text" id="bookPublisher" placeholder="Publisher" />
        </div>
        <button class="btn" onclick="addBook()">Add Book</button>
    </div>
    
    <h2>Books List</h2>
    <div id="booksList"></div>

    <script>
        console.log('Script loading...');
        
        let books = [];
        
        function showStatus(message, type) {
            console.log('Status:', message);
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = type;
            setTimeout(() => status.textContent = '', 3000);
        }
        
        function saveInfo() {
            console.log('Save button clicked');
            const name = document.getElementById('scannerName').value.trim();
            const teacher = document.getElementById('defaultTeacher').value.trim();
            
            if (!name || !teacher) {
                showStatus('Please enter both name and teacher', 'error');
                return;
            }
            
            localStorage.setItem('scannerName', name);
            localStorage.setItem('defaultTeacher', teacher);
            showStatus('Info saved successfully!', 'success');
        }
        
        function clearInfo() {
            console.log('Clear button clicked');
            localStorage.removeItem('scannerName');
            localStorage.removeItem('defaultTeacher');
            document.getElementById('scannerName').value = '';
            document.getElementById('defaultTeacher').value = '';
            showStatus('Info cleared!', 'success');
        }
        
        function takePhoto() {
            console.log('Photo button clicked');
            const scannerName = document.getElementById('scannerName').value.trim();
            const teacherName = document.getElementById('defaultTeacher').value.trim();
            
            if (!scannerName || !teacherName) {
                showStatus('Please save your info first', 'error');
                return;
            }
            
            document.getElementById('photoUpload').click();
        }
        
        function handleFile(input) {
            console.log('File selected');
            const file = input.files[0];
            if (file) {
                showStatus('Photo selected: ' + file.name, 'success');
                // For now, just show the form manually
                document.getElementById('extractedData').style.display = 'block';
                showStatus('Manual mode: Please type book information', 'success');
            }
        }
        
        function addBook() {
            console.log('Add book clicked');
            const title = document.getElementById('bookTitle').value.trim();
            const author = document.getElementById('bookAuthor').value.trim();
            const publisher = document.getElementById('bookPublisher').value.trim();
            const scannedBy = document.getElementById('scannerName').value.trim();
            const teacher = document.getElementById('defaultTeacher').value.trim();
            
            if (!title || !author) {
                showStatus('Please enter at least title and author', 'error');
                return;
            }
            
            const book = {
                id: Date.now(),
                title,
                author,
                publisher: publisher || 'Not specified',
                scannedBy,
                teacher,
                timestamp: new Date().toLocaleString()
            };
            
            books.unshift(book);
            updateBooksList();
            submitToGoogleSheets(book);
            
            // Reset form
            document.getElementById('bookTitle').value = '';
            document.getElementById('bookAuthor').value = '';
            document.getElementById('bookPublisher').value = '';
            document.getElementById('extractedData').style.display = 'none';
            
            showStatus('Book "' + title + '" added!', 'success');
        }
        
        function updateBooksList() {
            const booksList = document.getElementById('booksList');
            booksList.innerHTML = books.map(book => 
                '<div class="book-item">' +
                '<h3>' + book.title + '</h3>' +
                '<p><strong>Author:</strong> ' + book.author + '</p>' +
                '<p><strong>Publisher:</strong> ' + book.publisher + '</p>' +
                '<p><strong>Teacher:</strong> ' + book.teacher + '</p>' +
                '<p><em>Scanned by ' + book.scannedBy + ' on ' + book.timestamp + '</em></p>' +
                '</div>'
            ).join('');
        }
        
        async function submitToGoogleSheets(book) {
            try {
                console.log('Submitting to Google Sheets:', book);
                const formData = new FormData();
                formData.append('entry.751697957', book.title);
                formData.append('entry.654337640', book.author);
                formData.append('entry.1879822333', book.publisher);
                formData.append('entry.320463454', book.scannedBy);
                formData.append('entry.76820609', book.teacher);
                
                const response = await fetch('https://docs.google.com/forms/d/e/1FAIpQLScqbEx1MYyVhgYDq29SDNQiyY1F3MlF-3nbfBT950qRG5amVg/formResponse', {
                    method: 'POST',
                    body: formData,
                    mode: 'no-cors'
                });
                
                console.log('Google Sheets submission complete');
            } catch (error) {
                console.error('Google Sheets error:', error);
            }
        }
        
        // Load saved info on startup
        window.onload = function() {
            console.log('Page loaded');
            const savedName = localStorage.getItem('scannerName');
            const savedTeacher = localStorage.getItem('defaultTeacher');
            
            if (savedName) document.getElementById('scannerName').value = savedName;
            if (savedTeacher) document.getElementById('defaultTeacher').value = savedTeacher;
            
            if (savedName && savedTeacher) {
                showStatus('Welcome back, ' + savedName + '!', 'success');
            }
        };
        
        console.log('Script loaded successfully');
    </script>
</body>
</html>
